"use strict";angular.module("Authentication",[]);var app=angular.module("voteApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/ideas/:id/view",{templateUrl:"views/idea/idea_view.html",controller:"ideaViewController"}).when("/ideas/new",{templateUrl:"views/idea/idea_add.html",controller:"ideaAddController"}).when("/ideas/:id/edit",{templateUrl:"views/idea/idea_update.html",controller:"ideaUpdateController"}).otherwise({redirectTo:"/"})}]);angular.module("voteApp").controller("MainCtrl",["$scope","$rootScope",function(a,b){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],this.logged=!1,this.isLogged=function(){return b.globals&&b.globals.currentUser?(this.username=b.globals.currentUser.username,!0):!1},this.isLogged()}]),angular.module("voteApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("voteApp").controller("RegisterCtrl",["$scope","$location","User","AuthenticationService",function(a,b,c,d){a.user=new c,a.register=function(){a.user.$save(function(){d.setCredentials(a.user.username,a.user.token,a.user.id),b.path("/")})}}]),angular.module("voteApp").controller("LoginCtrl",["$scope","$rootScope","$location","AuthenticationService",function(a,b,c,d){a.username="heqi",a.password="123456",a.login=function(){console.log("click login"),d.login(a.username,a.password,function(b){b.success?(console.log("success"),a.errorMessage="Success",c.path("/")):(console.log("error"),a.username="",a.password="",a.errorMessage="Unauthorized")})}}]),angular.module("voteApp").controller("NavCtrl",["$scope","$rootScope","$location","AuthenticationService",function(a,b,c,d){this.tab=1,this.logged=!1,this.selectTab=function(a){this.tab=a},this.isSelected=function(a){return this.tab===a},this.isLogged=function(){return b.globals&&b.globals.currentUser?(this.username=b.globals.currentUser.username,!0):!1},this.isLogged(),this.logout=function(){d.clearCredentials(),this.isLogged()}}]),angular.module("voteApp").controller("ideaListCtrl",["$scope","$rootScope","$cookieStore","Idea",function(a,b,c,d){var e="";b.globals&&b.globals.currentUser&&(e=b.globals.currentUser.token,a.ideas=d.query({token:e})),a.up=function(a){console.log("up:"+a.id),a.score+=1,d.up({token:e,id:a.id})},a.down=function(a){console.log("down:"+a.id),d.down({token:e,id:a.id})}}]).controller("ideaViewController",["$scope","$rootScope","$routeParams","Idea",function(a,b,c,d){var e="",f="",g=!1;b.globals&&b.globals.currentUser&&(e=b.globals.currentUser.token,a.idea=d.get({token:e,id:c.id},function(){f=b.globals.currentUser.id,a.idea.user_id==f&&(g=!0)})),a.isCreator=function(){return g},a.up=function(b){console.log("up:"+b.id),d.up({token:e,id:b.id}),a.idea=d.get({token:e,id:c.id})},a.down=function(b){console.log("down:"+b.id),d.down({token:e,id:b.id}),a.idea=d.get({token:e,id:c.id})},a["delete"]=function(a){console.log("delte idea"),a.$delete(function(){console.log("success delete"),$location.path("/")})}}]).controller("ideaAddController",["$scope","$location","$rootScope","Idea",function(a,b,c,d){a.idea=new d;var e="",f={};c.globals&&c.globals.currentUser&&(f=c.globals.currentUser,e=c.globals.currentUser.token,a.idea.token=e,a.idea.user_id=f.id),a.addIdea=function(){a.idea.$save(function(){console.log("success"),b.path("/")})}}]).controller("ideaUpdateController",["$scope","$location","$rootScope","$routeParams","Idea",function(a,b,c,d,e){var f="",g={};c.globals&&c.globals.currentUser&&(g=c.globals.currentUser,f=c.globals.currentUser.token,a.idea=e.get({token:f,id:d.id},function(){a.idea.token=f})),a.editIdea=function(){a.idea.$update(function(){console.log("success"),b.path("/")})}}]),angular.module("voteApp").factory("Idea",["$resource","$rootScope",function(a){return a("https://sat-idea-voter.herokuapp.com/api/v1/ideas/:id",{token:"@token"},{update:{method:"put",params:{token:"@token",id:"@id"},url:"https://sat-idea-voter.herokuapp.com/api/v1/ideas/:id"},"delete":{method:"delete",params:{token:"@token",id:"@id"},url:"https://sat-idea-voter.herokuapp.com/api/v1/ideas/:id"},up:{method:"POST",params:{token:"@token",id:"@id"},url:"https://sat-idea-voter.herokuapp.com/api/v1/ideas/:id/up"},down:{method:"POST",params:{token:"@token",id:"@id"},url:"https://sat-idea-voter.herokuapp.com/api/v1/ideas/:id/down"}})}]),angular.module("voteApp").factory("AuthenticationService",["$http","$q","$window","$cookieStore","$rootScope",function(a,b,c,d,e){var f={},g={};return f.isLogged=function(){return 123},f.getToken=function(){return e.globals&&e.globals.currentUser?e.globals.currentUser.token:""},f.setCredentials=function(a,b,c){e.globals={currentUser:{username:a,token:b,id:c}},d.put("globals",e.globals)},f.clearCredentials=function(){e.globals={},d.remove("globals")},f.login=function(b,d,e){a.post("https://sat-idea-voter.herokuapp.com/api/v1/login",{username:b,password:d}).then(function(a){a.data.token,a.data.id;g={success:!0,token:a.data.token,username:a.data.username,id:a.data.id},f.setCredentials(a.data.username,a.data.token,a.data.id),c.sessionStorage.userInfo=JSON.stringify(g),e(g)},function(a){e(a)})},f}]),angular.module("voteApp").factory("User",["$resource","$rootScope",function(a){return a("https://sat-idea-voter.herokuapp.com/api/v1/signup",{username:"@username",password:"@password",password_confirmation:"@password_confirmation"})}]);